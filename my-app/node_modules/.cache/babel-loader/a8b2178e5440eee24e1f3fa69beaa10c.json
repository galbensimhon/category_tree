{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\Gal\\\\WebstormProjects\\\\CategoryTree\\\\my-react-app\\\\src\\\\components\\\\MyLoader.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { useHistory } from \"react-router-dom\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Container } from \"@material-ui/core\";\nimport Paper from '@material-ui/core/Paper';\nimport Grid from \"@material-ui/core/Grid\";\nimport FormControl from '@material-ui/core/FormControl';\nimport Select from '@material-ui/core/Select';\nimport InputLabel from \"@material-ui/core/InputLabel\";\nimport Button from '@material-ui/core/Button';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport FormDialog from \"./FormDialog\";\nimport { MenuItem } from \"react-contextmenu\";\nimport { saveData, loadData } from '../Api';\nimport _ from \"lodash\";\nimport { FILE, FOLDER } from \"../utills/constants\";\nimport { getFatherPath } from \"../utills/utills\";\nconst data = {\n  '/root': {\n    path: '/root',\n    type: FOLDER,\n    isRoot: true,\n    isOpen: false,\n    children: ['/root/gal', '/root/ben']\n  },\n  '/root2': {\n    path: '/root2',\n    type: FOLDER,\n    isRoot: true,\n    isOpen: false,\n    children: ['/root2/gal2']\n  },\n  '/root2/gal2': {\n    path: '/root2/gal2',\n    type: FOLDER,\n    isRoot: false,\n    isOpen: false,\n    children: []\n  },\n  '/root/gal': {\n    path: '/root/gal',\n    type: FOLDER,\n    isOpen: false,\n    children: ['/root/gal/read.txt']\n  },\n  '/root/ben': {\n    path: '/root/ben',\n    type: FOLDER,\n    isOpen: false,\n    children: []\n  },\n  '/root/gal/read.txt': {\n    path: '/root/gal/read.txt',\n    type: FILE,\n    isOpen: false\n  }\n};\nconst useStyles = makeStyles(theme => ({\n  button: {\n    marginBottom: theme.spacing(1)\n  }\n}));\nexport function MyLoader() {\n  _s();\n\n  const classes = useStyles();\n  const [treeName, setTreeName] = useState(null);\n  const history = useHistory();\n  const [nodes, setNodes] = useState({});\n\n  const getRootNodes = nodes => {\n    return _.map(_.filter(_.values(nodes), node => {\n      return node.isRoot === true;\n    }), node => _.last(node.path.split('/')));\n  };\n\n  const [allRoots, setAllRoots] = useState({});\n\n  const onAddRoot = (newFile, is_file, is_root) => {\n    if (newFile) {\n      if (newFile in nodes) {\n        alert(`There is already a file with this name in folder,\\n Please insert different name!`);\n        return;\n      }\n\n      let nodes_copy = JSON.parse(JSON.stringify(nodes));\n\n      if (!is_root) {\n        let father_path = getFatherPath(newFile);\n\n        if (father_path == null || nodes[father_path].type === FILE) {\n          return;\n        }\n\n        nodes_copy[father_path].children.push(newFile);\n      }\n\n      nodes_copy[newFile] = is_file ? {\n        path: newFile,\n        type: FILE,\n        isOpen: false\n      } : {\n        path: newFile,\n        type: FOLDER,\n        isOpen: false,\n        children: []\n      };\n\n      if (is_root) {\n        nodes_copy[newFile].isRoot = true;\n      }\n\n      console.log(`Adding ${is_file ? FILE : FOLDER} ${newFile}`); //TODO: should implement\n\n      let res = saveData(nodes_copy);\n      setNodes(nodes_copy);\n    }\n  };\n\n  useEffect(() => {}, [allRoots, treeName]);\n  useEffect(() => {\n    const onRender = async () => {\n      let res = await loadData();\n      setNodes(res);\n      setAllRoots(getRootNodes(res));\n    };\n\n    onRender();\n  }, []);\n\n  const changedCateTreeOption = name => {\n    setTreeName(name);\n  };\n\n  const loadClicked = () => {\n    if (treeName === '' || treeName == null) {\n      alert('Please choose category tree first, and then click Load!');\n      return;\n    }\n\n    history.push(`${process.env.PUBLIC_URL}/categorytree/tree?id=${treeName}`);\n  };\n\n  const createClicked = (name, type) => {\n    let newRoots = allRoots.slice();\n    newRoots.push(name);\n    setAllRoots(newRoots);\n    onAddRoot(`/${name}`, false, true);\n    changedCateTreeOption(name);\n  };\n\n  let no_roots_bool = allRoots.length > 0;\n\n  const InitialComponent = () => /*#__PURE__*/_jsxDEV(Grid, {\n    align: \"center\",\n    item: true,\n    className: classes.button,\n    children: /*#__PURE__*/_jsxDEV(Button, {\n      style: {\n        marginTop: '10px',\n        marginBottom: '10px',\n        marginLeft: '5px'\n      },\n      variant: \"contained\",\n      color: \"primary\",\n      children: /*#__PURE__*/_jsxDEV(FormDialog, {\n        text: 'Create',\n        onClickOk: createClicked\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 144,\n    columnNumber: 9\n  }, this);\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(Container, {\n      maxWidth: 'md',\n      children: no_roots_bool ? /*#__PURE__*/_jsxDEV(Paper, {\n        elevation: 3,\n        children: /*#__PURE__*/_jsxDEV(Grid, {\n          container: true,\n          alignItems: 'center',\n          direction: 'column',\n          children: [/*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            children: /*#__PURE__*/_jsxDEV(FormControl, {\n              style: {\n                minWidth: 250\n              },\n              children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n                children: \"Select category tree\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 158,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(Select, {\n                value: treeName,\n                onChange: e => changedCateTreeOption(e.target.value),\n                children: _.map(allRoots, node => {\n                  return /*#__PURE__*/_jsxDEV(MenuItem, {\n                    value: node,\n                    children: node\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 163,\n                    columnNumber: 61\n                  }, this);\n                })\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 159,\n                columnNumber: 41\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 157,\n              columnNumber: 37\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 156,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(Grid, {\n            item: true,\n            className: classes.button,\n            children: [/*#__PURE__*/_jsxDEV(Tooltip, {\n              title: \"Go to selected category!\",\n              children: /*#__PURE__*/_jsxDEV(Button, {\n                style: {\n                  marginTop: '10px',\n                  marginBottom: '10px',\n                  marginRight: '5px'\n                },\n                onClick: loadClicked,\n                variant: \"contained\",\n                color: \"primary\",\n                children: \"Go!\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 171,\n                columnNumber: 41\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 170,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n              title: \"Create new category tree!\",\n              children: /*#__PURE__*/_jsxDEV(Button, {\n                style: {\n                  marginTop: '10px',\n                  marginBottom: '10px',\n                  marginLeft: '5px'\n                },\n                variant: \"contained\",\n                color: \"primary\",\n                children: /*#__PURE__*/_jsxDEV(FormDialog, {\n                  text: 'Create',\n                  onClickOk: createClicked\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 177,\n                  columnNumber: 45\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 176,\n                columnNumber: 41\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 175,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 169,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 25\n      }, this) : /*#__PURE__*/_jsxDEV(InitialComponent, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 26\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 151,\n    columnNumber: 9\n  }, this);\n}\n\n_s(MyLoader, \"xf06Wc5ZdnRNoDokBmptahp1wSs=\", false, function () {\n  return [useStyles, useHistory];\n});\n\n_c = MyLoader;\nexport default MyLoader;\n\nvar _c;\n\n$RefreshReg$(_c, \"MyLoader\");","map":{"version":3,"sources":["C:/Users/Gal/WebstormProjects/CategoryTree/my-react-app/src/components/MyLoader.js"],"names":["React","useEffect","useState","useHistory","makeStyles","Container","Paper","Grid","FormControl","Select","InputLabel","Button","Tooltip","FormDialog","MenuItem","saveData","loadData","_","FILE","FOLDER","getFatherPath","data","path","type","isRoot","isOpen","children","useStyles","theme","button","marginBottom","spacing","MyLoader","classes","treeName","setTreeName","history","nodes","setNodes","getRootNodes","map","filter","values","node","last","split","allRoots","setAllRoots","onAddRoot","newFile","is_file","is_root","alert","nodes_copy","JSON","parse","stringify","father_path","push","console","log","res","onRender","changedCateTreeOption","name","loadClicked","process","env","PUBLIC_URL","createClicked","newRoots","slice","no_roots_bool","length","InitialComponent","marginTop","marginLeft","minWidth","e","target","value","marginRight"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from 'react';\r\nimport {useHistory} from \"react-router-dom\";\r\nimport {makeStyles} from \"@material-ui/core/styles\";\r\nimport {Container} from \"@material-ui/core\";\r\nimport Paper from '@material-ui/core/Paper';\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport Select from '@material-ui/core/Select';\r\nimport InputLabel from \"@material-ui/core/InputLabel\";\r\nimport Button from '@material-ui/core/Button';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\nimport FormDialog from \"./FormDialog\";\r\nimport { MenuItem } from \"react-contextmenu\";\r\nimport { saveData, loadData } from '../Api'\r\nimport _ from \"lodash\";\r\nimport {FILE, FOLDER} from \"../utills/constants\";\r\nimport {getFatherPath} from \"../utills/utills\";\r\n\r\nconst data = {\r\n    '/root': {\r\n        path: '/root',\r\n        type: FOLDER,\r\n        isRoot: true,\r\n        isOpen: false,\r\n        children: ['/root/gal', '/root/ben']\r\n    },\r\n    '/root2': {\r\n        path: '/root2',\r\n        type: FOLDER,\r\n        isRoot: true,\r\n        isOpen: false,\r\n        children: ['/root2/gal2']\r\n    },\r\n    '/root2/gal2': {\r\n        path: '/root2/gal2',\r\n        type: FOLDER,\r\n        isRoot: false,\r\n        isOpen: false,\r\n        children: []\r\n    },\r\n    '/root/gal': {\r\n        path: '/root/gal',\r\n        type: FOLDER,\r\n        isOpen: false,\r\n        children: ['/root/gal/read.txt']\r\n    },\r\n    '/root/ben': {\r\n        path: '/root/ben',\r\n        type: FOLDER,\r\n        isOpen: false,\r\n        children: []\r\n    },\r\n    '/root/gal/read.txt': {\r\n        path: '/root/gal/read.txt',\r\n        type: FILE,\r\n        isOpen: false,\r\n    }\r\n}\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n    button:{\r\n        marginBottom: theme.spacing(1)\r\n    }\r\n}));\r\n\r\nexport function MyLoader() {\r\n    const classes = useStyles();\r\n    const [treeName, setTreeName] = useState(null);\r\n    const history = useHistory();\r\n    const [nodes, setNodes] = useState({});\r\n\r\n    const getRootNodes = (nodes) => {\r\n        return _.map(_.filter(_.values(nodes), (node) => { return node.isRoot === true;}),(node) => _.last(node.path.split('/')));\r\n    }\r\n    const [allRoots, setAllRoots] = useState({});\r\n\r\n    const onAddRoot = (newFile, is_file, is_root) => {\r\n        if(newFile){\r\n            if (newFile in nodes){\r\n                alert(`There is already a file with this name in folder,\\n Please insert different name!`);\r\n                return;\r\n            }\r\n            let nodes_copy = JSON.parse(JSON.stringify(nodes));\r\n            if(!is_root) {\r\n                let father_path = getFatherPath(newFile);\r\n                if (father_path == null || nodes[father_path].type === FILE) {\r\n                    return;\r\n                }\r\n                nodes_copy[father_path].children.push(newFile);\r\n            }\r\n\r\n            nodes_copy[newFile] = is_file ? {\r\n                path: newFile,\r\n                type: FILE,\r\n                isOpen: false\r\n            } : {\r\n                path: newFile,\r\n                type: FOLDER,\r\n                isOpen: false,\r\n                children: []\r\n            }\r\n            if(is_root){\r\n                nodes_copy[newFile].isRoot = true;\r\n            }\r\n            console.log(`Adding ${is_file ? FILE : FOLDER} ${newFile}`);\r\n            //TODO: should implement\r\n            let res = saveData(nodes_copy);\r\n            setNodes(nodes_copy);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n    }, [allRoots, treeName])\r\n\r\n    useEffect(() => {\r\n        const onRender = async () => {\r\n            let res = await loadData();\r\n            setNodes(res);\r\n            setAllRoots(getRootNodes(res));\r\n        }\r\n        onRender();\r\n    }, [])\r\n    const changedCateTreeOption = (name) => {\r\n        setTreeName(name);\r\n    }\r\n    const loadClicked = () => {\r\n        if(treeName === '' || treeName == null){\r\n            alert('Please choose category tree first, and then click Load!');\r\n            return;\r\n        }\r\n        history.push(`${process.env.PUBLIC_URL}/categorytree/tree?id=${treeName}`)\r\n    }\r\n    const createClicked = (name, type) => {\r\n\r\n        let newRoots = allRoots.slice();\r\n        newRoots.push(name);\r\n        setAllRoots(newRoots);\r\n        onAddRoot(`/${name}`, false, true);\r\n        changedCateTreeOption(name);\r\n    }\r\n\r\n    let no_roots_bool = allRoots.length > 0;\r\n    const InitialComponent = () => (\r\n        <Grid align=\"center\" item  className={classes.button}>\r\n            <Button style={{marginTop: '10px', marginBottom: '10px', marginLeft: '5px'}} variant=\"contained\" color=\"primary\">\r\n                <FormDialog text={'Create'} onClickOk={createClicked} />\r\n            </Button>\r\n        </Grid>\r\n    );\r\n    return(\r\n        <div>\r\n            <Container maxWidth={'md'} >\r\n                    { no_roots_bool ? (\r\n                        <Paper elevation={3} >\r\n                            <Grid container alignItems={'center'} direction={'column'}>\r\n                                <Grid item >\r\n                                    <FormControl style={{minWidth: 250}} >\r\n                                        <InputLabel>Select category tree</InputLabel>\r\n                                        <Select value={treeName}\r\n                                            onChange={(e) => changedCateTreeOption(e.target.value)}>\r\n                                            {\r\n                                                _.map(allRoots, (node) => {\r\n                                                    return (<MenuItem value={node}>{node}</MenuItem>)\r\n                                                })\r\n                                            }\r\n                                        </Select>\r\n                                    </FormControl>\r\n                                </Grid>\r\n                                <Grid item className={classes.button}>\r\n                                    <Tooltip title=\"Go to selected category!\">\r\n                                        <Button style={{marginTop: '10px', marginBottom: '10px', marginRight: '5px'}} onClick={loadClicked} variant=\"contained\" color=\"primary\">\r\n                                            Go!\r\n                                        </Button>\r\n                                    </Tooltip>\r\n                                    <Tooltip title=\"Create new category tree!\">\r\n                                        <Button style={{marginTop: '10px', marginBottom: '10px', marginLeft: '5px'}} variant=\"contained\" color=\"primary\">\r\n                                            <FormDialog text={'Create'} onClickOk={createClicked} />\r\n                                        </Button>\r\n                                    </Tooltip>\r\n                                </Grid>\r\n                            </Grid>\r\n                        </Paper>) :\r\n                        (<InitialComponent/>)\r\n                    }\r\n            </Container>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default MyLoader;"]},"metadata":{},"sourceType":"module"}